function VernierCaliper(a,b){var c=Math.min,d=Math.max;function e(a,c,d,e){b.beginPath(),b.moveTo(a,c),b.lineTo(d,e),b.stroke()}function f(a){B+=a,0>B?(B=C+B,A-=1):B>=C&&(B-=C,A+=1);let c=g();0>=c&&(A=0,B=0),c>=E*O&&(A=E,B=0),b.refresh()}function g(){return(A+B/C)*O}function h(a,c,d,e,f){var g=b.measureText(d),i=10;switch(f){case 0:c+=i;break;case 1:c+=i/2;break;case 2:}0===e?b.fillText(d,a+3,c):1===e?b.fillText(d,a-g.width/2,c):2===e?b.fillText(d,a-g.width/2,c):void 0}let i=0,j=new Image,k=new Image,l=new Image,m=new Image,n=new Image,o=new Image,p=new Image,q=20,r=30,s=.5,t=0,u=!1,v=0,w=["Pin","Unpin"],z=[ContextMenu.pinIcon,ContextMenu.unpinIcon];var A=0,B=0,C=10;var D=600/E,E=50;const F=162,G=67,H=12,I="black";var J=0;const K=161,L=13;var M,N,E=50,O=.1,C=10,D=600/E,P=600/E,A=0,B=0,J=0,Q={path:null,x:0,y:0,length:100,w:100,h:100,R1:30,R2:50,h2:100,h1:80,th:0,mode:0,state:0};let R;j.src="assets/vc/vernier.png",j.onload=i++,k.src="assets/vc/vernier1.png",k.onload=i++,l.src="assets/vc/vernier2.png",l.onload=i++,m.src="assets/vc/vernier3.png",m.onload=i++,n.src="assets/vc/blade.png",n.onload=i++,o.src="assets/vc/vernier_base.png",o.onload=i++,p.src="assets/vc/vlab-logo-sm.png",p.onload=i++;var S=new Audio("assets/vc/tick.wav");S.onload=i++;const T=({x:a,y:b})=>{if(boundary={xmin:q+0*s,xmax:q+1100*s,ymin:r+50*s,ymax:r+350*s},a>boundary.xmin&&a<boundary.xmax&&b>boundary.ymin&&b<boundary.ymax)return!0},U=({x:a,y:b})=>{let c=G+(A+B/C)*D,d=s*devicePixelRatio;if(boundary={xmin:q+c*d,xmax:q+(c+k.width-60)*d,ymin:r+(F-100)*d,ymax:r+354*d},a>boundary.xmin&&a<boundary.xmax&&b>boundary.ymin&&b<boundary.ymax)return!0},V=b=>{let c=a.getBoundingClientRect(),d=(b.clientX-c.left)*devicePixelRatio,e=(b.clientY-c.top)*devicePixelRatio;return{x:d,y:e}},W=a=>{N&&M.closeMenu(N)},X=a=>(u&&N&&M.closeMenu(N),u&&T(V(a))&&(M.setMenuItems([{content:`${ContextMenu.deleteIcon}Delete`,divider:"top",events:{click:Y}},{content:`${z[v]}${w[v]}`,divider:"top",events:{click:()=>{N&&M.closeMenu(N),v=v?0:1,b.refresh()}}}]),N=M.show(a)),!0),Y=()=>{N&&M.closeMenu(N),u=!1,b.refresh()};return{init:()=>{u=!0,i>=8&&b.refresh(),M=new ContextMenu},onMouseDownHandler:a=>{U(V(a))?(t=2,R=a.clientX):0==v&&T(V(a))&&(t=1)},onMouseUpHandler:a=>{t=0},onMouseMoveHandler:a=>{var c=Math.round;if(0!=t){let d=(a.clientX-R)/s;if(R=a.clientX,2==t){if(A>=E&&0<d)return void b.refresh();if(0==A&&0==B&&0>d)return void b.refresh();f(c(d))}else if(1==t){let{x:c,y:d}=V(a);q=c-20,r=d-10,b.refresh()}}},onContextMenuHandler:X,onClickHandler:W,onMouseWheelHandler:a=>{if(u&&T(V(a))){let{deltaY:e}=a;s=0<e?d(.1,s-.05):c(1,s+.05),b.refresh()}},paint:()=>{if(!u)return;b.translate(q,r),b.scale(s*devicePixelRatio,s*devicePixelRatio),b.save();let a=(A+B/C)*D,c=915+a-716,d=(105+F)/2-20/2;b.drawImage(n,c,d),b.drawImage(o,0,0),b.translate(G+H,F),b.fillStyle=I,b.strokeStyle=I,c=-D*J/C,d=0;let f=0,g=0;for(;50>D*g;)g+=5;for(let a=0;a<=E;a++)f=0==a%5?22:L,e(c,d,c,d-f),0==a%g&&h(c,d-f-3,a*O,1,2),c+=D;if(!1){b.lineWidth=.5;let a=D/C,c=-D*J/C+getMainScaleReading()*D;f=L-3;for(let b=0;b<=C;b++)e(c,d,c,d-f),c+=a;b.lineWidth=1.5}b.restore(),b.strokeStyle=I,b.fillStyle=I,h(844,117,"1 MSD = "+O+"cm",1,0),b.fillStyle=fgColor,h(844,135,"Virtual Lab",1,0),b.fillStyle=I,c=G-H+a-55,d=F-K,b.drawImage(k,c,d);let i=220-k.width-m.width;if(0<i){let a=k.height;b.drawImage(l,0,0,i,a,c+k.width,d,i,a)}b.drawImage(m,c+k.width+i,d),c=G+a+H,d=K-1,b.font="8pt sans-serif";let j=C;for(g=0;20>P*g;)g+=1;for(let a=0;a<=j;a++)f=8,0==a%g&&(f=10,h(c,d+f+1,a,1,0)),e(c,d,c,d+f),c+=P;b.fillStyle=fgColor,b.font="12pt sans-serif",b.drawImage(o,0,0,64,102,0,0,64,102),0<Q.state&&(b.save(),b.fillStyle="rgb(130,190,140)",b.strokeStyle=I,b.translate(Q.x,Q.y),b.rotate(Q.th),b.fill(Q.path),b.stroke(Q.path),b.restore()),b.resetTransform()},destory:Y}}function UTM(a,b){var c=Math.min,d=Math.max;function e(a,c){b.beginPath(),b.moveTo(a.x,a.y),b.lineTo(c.x,c.y),b.stroke()}let f="assets/utm/",g=4,h=0,i=new Image,j=new Image,k=new Image,l=new Image,m=30,n=120,o=0,p=0,q=0,r=["Pin","Unpin"],s=[ContextMenu.pinIcon,ContextMenu.unpinIcon],t=.5,u=0,v=0,w=!1;i.src="assets/utm/utm1.png",i.onload=h++,j.src="assets/utm/utm2.png",j.onload=h++,k.src="assets/utm/utm3.png",k.onload=h++,l.src="assets/utm/utm3.png",l.onload=h++;var z,A=null;const B=()=>{w=!0,h>=g&&b.refresh(),z=new ContextMenu},C=()=>{if(w){x=(m+105)*t,y=(n+180)*t,b.drawImage(k,x,y,k.width*t,k.height*t),x=(m+295)*t,y=(n+180)*t,b.drawImage(l,x,y,l.width*t,l.height*t),x=(m+68)*t;let a=90*o-120;y=(n-a)*t,b.drawImage(j,x,y,j.width*t,j.height*t),x=m*t,y=(n+500)*t,b.drawImage(i,x,y,i.width*t,i.height*t),b.save()}},D=(a,c)=>{if(-1==c){let c=setInterval(()=>(step=.05*a,o-=step,0>=o?void clearInterval(c):void b.refresh()),100)}else{let c=setInterval(()=>(step=.05*a,o+=step,1<=o?void clearInterval(c):void b.refresh()),100)}},E=({x:a,y:b})=>{if(boundary={xmin:(m+50)*t,xmax:(m+400)*t,ymin:(n+80)*t,ymax:(n+900)*t},a>boundary.xmin&&a<boundary.xmax&&b>boundary.ymin&&b<boundary.ymax)return!0},F=b=>{let c=a.getBoundingClientRect(),d=(b.clientX-c.left)*devicePixelRatio,e=(b.clientY-c.top)*devicePixelRatio;return{x:d,y:e}},G=a=>{A&&z.closeMenu(A)},H=a=>{if(0==q&&E(F(a)))return void(p=1)},I=a=>{p=0},J=c=>{if(0!=p){const d=a.getBoundingClientRect();let{x:e,y:f}=F(c);1==p&&(m=(e-200*t)/t,n=(f-500*t)/t,b.refresh())}},K=a=>{if(w&&E(F(a))){let{deltaY:e}=a;t=0<e?d(.1,t-.05):c(2,t+.05),b.refresh()}},L=a=>(w&&A&&z.closeMenu(A),w&&E(F(a))&&(z.setMenuItems([{content:`${ContextMenu.deleteIcon}Delete`,divider:"top",events:{click:M}},{content:`${s[q]}${r[q]}`,divider:"top",events:{click:()=>{A&&z.closeMenu(A),q=q?0:1,b.refresh()}}}]),A=z.show(a)),!0),M=()=>{A&&z.closeMenu(A),w=!1,b.refresh()};return{init:B,start:D,onMouseDownHandler:H,onMouseUpHandler:I,onMouseMoveHandler:J,onContextMenuHandler:L,onClickHandler:G,onMouseWheelHandler:K,paint:C,destory:M}}
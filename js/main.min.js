const canvas=document.getElementById("gui"),menu=document.querySelector(".menu"),main=document.querySelector(".main"),slider=document.getElementById("slider");var draggedElement,ctx,dragging=!1,utm=null,vc=null,sample1=null,canvasWidth=main.offsetWidth-20,canvasHeight=main.offsetHeight-20;function init(){ctx=canvas.getContext("2d"),ctx.font="30px Arial",ctx.lineWidth=1.5,utm=UTM(canvas,ctx),vc=VernierCaliper(canvas,ctx),sample1=Sample1(canvas,ctx),window.addEventListener("resize",resize),canvas.addEventListener("mousedown",onMouseDownHandler),canvas.addEventListener("mousemove",onMouseMoveHandler),window.addEventListener("mouseup",onMouseUpHandler),canvas.addEventListener("mousewheel",onMouseWheelHandler),canvas.addEventListener("drop",onElementDrop),document.addEventListener("touchend",a=>{onElementDrop(a.touches[0])}),canvas.addEventListener("contextmenu",onContextMenuHandler),canvas.addEventListener("click",onClickHandler),canvas.addEventListener("touchstart",a=>onMouseDownHandler(a.touches[0])),canvas.addEventListener("touchmove",a=>onMouseMoveHandler(a.touches[0])),window.addEventListener("touchend",a=>onMouseUpHandler(a.touches[0])),canvas.addEventListener("mousewheel",onMouseWheelHandler),canvas.addEventListener("drop",onElementDrop),ctx.refresh=()=>{for(canvas.width=canvasWidth*devicePixelRatio,canvas.height=canvasHeight*devicePixelRatio,canvas.style.width=canvasWidth+"px",canvas.style.height=canvasHeight+"px",i=0;i<canvas.width;i+=50)for(j=0;j<canvas.height;j+=50)ctx.fillStyle="rgb(160,160,160)",ctx.fillRect(i,j,3,3);vc&&vc.paint(),utm&&utm.paint(),sample1&&sample1.paint()},ctx.refresh()}function resize(){10>window.innerWidth||10>window.innerHeight||(canvasWidth=main.offsetWidth-20,canvasHeight=main.offsetHeight-20,ctx.refresh())}function onMouseDownHandler(a){utm&&utm.onMouseDownHandler(a),vc&&vc.onMouseDownHandler(a),sample1&&sample1.onMouseDownHandler(a)}function onMouseMoveHandler(a){utm&&utm.onMouseMoveHandler(a),vc&&vc.onMouseMoveHandler(a),sample1&&sample1.onMouseMoveHandler(a)}function onMouseUpHandler(a){utm&&utm.onMouseUpHandler(a),vc&&vc.onMouseUpHandler(a),sample1&&sample1.onMouseUpHandler(a)}function onContextMenuHandler(a){a.preventDefault(),a.stopPropagation(),utm&&utm.onContextMenuHandler(a),vc&&vc.onContextMenuHandler(a),sample1&&sample1.onContextMenuHandler(a)}function onClickHandler(a){a.preventDefault(),a.stopPropagation(),utm&&utm.onClickHandler(a),vc&&vc.onClickHandler(a),sample1&&sample1.onClickHandler(a)}function onMouseWheelHandler(a){a.preventDefault(),a.stopPropagation(),utm&&utm.onMouseWheelHandler(a),vc&&vc.onMouseWheelHandler(a),sample1&&sample1.onMouseWheelHandler(a)}function onElementDrop(){if(draggedElement)switch(draggedElement.getAttribute("label")){case"utmMachine":utm.init();break;case"vernierCaliper":vc.init();break;case"sample1":sample1.init();}}window.onload=init,slider.addEventListener("mousedown",()=>dragging=!0),document.addEventListener("mousemove",slideWindow),document.addEventListener("mouseup",()=>dragging=!1),slider.addEventListener("touchstart",a=>{a.preventDefault(),a.stopPropagation(),dragging=!0}),document.addEventListener("touchstart",a=>{draggedElement&&(draggedElement.remove(),draggedElement=null);let b=a.touches[0].target;("utmMachine"==b.getAttribute("label")||"vernierCaliper"==b.getAttribute("label"))&&(img=document.createElement("img"),img.src=b.src,img.setAttribute("label",b.getAttribute("label")),img.onload=()=>{document.body.appendChild(img),draggedElement=img})}),document.addEventListener("touchmove",a=>{slideWindow(a.touches[0]);draggedElement&&(draggedElement.style.position="absolute",draggedElement.style.left=a.touches[0].clientX+"px",draggedElement.style.top=a.touches[0].clientY+"px")}),document.addEventListener("touchend",()=>{dragging=!1,draggedElement&&(draggedElement.style.display="none")}),document.addEventListener("dragstart",a=>{draggedElement=a.target}),document.addEventListener("dragover",a=>{a.preventDefault()});function slideWindow(a){dragging&&(menu.style.width=a.clientX+"px",main.style.width=window.innerWidth-a.clientX+"px",canvasWidth=main.offsetWidth-25,canvasHeight=main.offsetHeight-25,ctx.refresh())}